@media (max-width: 767px) {
    
    /* 1. Body Text & General Content */
    /* Target: Body, Paragraphs, List Items, Content Articles */
    body, 
    p, 
    li,
    .p-content, 
    .li-content,
    .card-content,
    article.content p, 
    article.content li,
    .accordion-button {
        /* Use the variable so the JS font resizer works, default to 18px if unset */
        font-size: var(--content-font-size, 18px) !important; 
        line-height: 1.6 !important;
    }

    /* 2. H1 / Page Titles */
    /* Target: Main Headers, Page Title Cards */
    h1, 
    .page-title-card h1,
    .bio-page h1 {
        font-size: 2rem !important; /* 32px */
        line-height: 1.3 !important;
    }

    /* 3. H2 / Section Titles */
    /* Target: Sub-headers, Section dividers */
    h2, 
    .section, 
    article.content h2.section,
    .bio-page h2 {
        font-size: 1.5rem !important; /* 24px */
        line-height: 1.4 !important;
    }

    /* 4. H3 / Card Titles & Subsections */
    /* Target: Content Headers, Card Titles, Bio Page Items */
    h3, 
    h4,
    .h3-content-title, 
    .h4-content-title,
    .h5-content-title,
    article.content h3.sub,
    .card-title,
    .bio-page h3, 
    .bio-page h4,
    .item-title,
    .q-title,
    #front-header,
    #back-header {
        font-size: 1.25rem !important; /* 20px */
        line-height: 1.4 !important;
    }

    /* 5. Secondary / Small Text */
    /* Target: Badges, Meta info, Navigation links */
    small, 
    .text-muted, 
    .text-sm,
    .badge, 
    .question-number, 
    .nav-link-desktop,
    .btn-custom,
    .btn-answer,
    footer {
        font-size: 0.875rem !important; /* 14px */
    }

    /* 6. Form Inputs (Prevents iOS Zoom on focus) */
    input, 
    select, 
    textarea,
    .question-card.fill-blank input {
        font-size: 1.125rem !important; /* 18px - Safe for mobile */
    }

    /* ==========================================================================
       MOBILE-FIRST LAYOUT PREPARATION
       ========================================================================== */

    /* 1. Full-Width Layout Override */
    body,
    .main-width-container {
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
        padding-bottom: 80px; /* Space for bottom nav */
    }

/* === Mobile Bottom Nav Container (Green Gradient) === */
#mobile-bottom-nav {
    position: fixed !important;
    bottom: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 70px;
    /* The Green Gradient Background */
    background: linear-gradient(to right, #16a34a, #047857) !important; 
    border-top: 1px solid rgba(255,255,255,0.1);
    display: flex;
    justify-content: space-around;
    align-items: flex-end;
    z-index: 9999;
    padding-bottom: 8px;
    box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
}

/* Nav Items (White Text/Icons) */
.mobile-nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;
    color: rgba(255, 255, 255, 0.85) !important; /* Semi-transparent white */
    background: transparent;
    border: none;
    cursor: pointer;
    width: 20%;
    position: relative;
    transition: all 0.3s ease;
}

.mobile-nav-item .label-text {
    font-size: 10px;
    margin-top: 4px;
    font-weight: 700;
    font-family: 'Tajawal', sans-serif;
}

.mobile-nav-item svg {
    width: 24px;
    height: 24px;
    stroke: currentColor;
    transition: all 0.3s ease;
}

/* === FLOATING ACTIVE EFFECT (Cutout Look) === */
.mobile-nav-item.active-tab .icon-container {
    background-color: #ffffff; /* White Circle */
    width: 54px;
    height: 54px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    bottom: 25px; /* Float UP */
    box-shadow: 0 -4px 15px rgba(0,0,0,0.2);
    border: 4px solid #f3f4f6; /* Match page BG color for cutout effect */
    transform: translateY(0);
    z-index: 10;
}

/* Active Icon Color (Green inside White Circle) */
.mobile-nav-item.active-tab {
    color: #ffffff !important; /* Label remains white */
    opacity: 1;
}
.mobile-nav-item.active-tab svg {
    stroke: #16a34a !important; /* Green Icon */
    stroke-width: 2.5px;
}
/* Ensure the active label is visible on the green bar */
.mobile-nav-item.active-tab .label-text {
    color: #ffffff;
    font-weight: 900;
}

/* === POPUP SHEETS (Green Gradient & Better Spacing) === */
.mobile-popup-sheet {
    position: fixed !important;
    bottom: 85px !important;
    /* Gradient Background for Popups too */
    background: linear-gradient(to right, #16a34a, #047857) !important;
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 16px;
    box-shadow: 0 5px 25px rgba(0,0,0,0.25);
    z-index: 10000;
    padding: 8px 0;
    display: flex;
    flex-direction: column;
    min-width: 180px;
}

/* Positioning Fixes */
.popup-pos-left { 
    right: 10px !important; 
    left: auto !important; 
}

.popup-pos-right { 
    left: 10px !important; 
    right: auto !important; 
}

.popup-pos-center { 
    left: 50% !important; 
    transform: translateX(-50%); 
    width: 260px; 
}

/* Links inside Popups (White Text) */
.mobile-popup-link {
    display: block;
    padding: 12px 16px;
    color: #ffffff !important;
    text-decoration: none;
    font-size: 14px;
    font-family: 'Tajawal', sans-serif;
    font-weight: 700;
    border-bottom: 1px solid rgba(255, 255, 255, 0.15); /* Subtle separator */
    text-align: right;
    transition: background 0.2s;
}
.mobile-popup-link:last-child { border-bottom: none; }
.mobile-popup-link:active { background: rgba(255,255,255,0.1); }

/* === TOOLS / SETTINGS STYLES (White Buttons) === */
.tools-row {
    display: flex;
    justify-content: space-evenly;
    align-items: center;
    margin: 8px 0;
    padding: 0 10px;
}
.tool-circle-btn {
    width: 38px;
    height: 38px;
    border-radius: 50%;
    border: 1.5px solid rgba(255,255,255,0.6) !important;
    background: transparent !important;
    color: #ffffff !important;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 13px;
    cursor: pointer;
}
.divider-line {
    height: 1px;
    background: rgba(255,255,255,0.15);
    margin: 6px 0;
    width: 100%;
}
/* Full width buttons in settings */
.tool-full-btn {
    width: 90%;
    margin: 0 auto;
    border-radius: 8px;
    padding: 8px;
    border: 1.5px solid rgba(255,255,255,0.6) !important;
    background: transparent !important;
    color: #ffffff !important;
}

/* === ULTRA-COMPACT TEXT LAYOUT === */

/* 1. Global Container Reset */
body, 
.main-width-container, 
.container-main, 
article.content, 
.content-container {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    /* Minimize padding to bare minimum safety (4px) */
    padding-left: 4px !important;
    padding-right: 4px !important;
}

/* 2. Text Alignment & Justification (Fill the line) */
p, 
li, 
.p-content, 
.li-content, 
.a, 
.q-title span, 
.h3-content-title {
    text-align: justify !important; /* Forces text to fill width */
    text-justify: inter-word !important; /* Better for Arabic */
    margin-left: 0 !important;
    margin-right: 0 !important;
    padding: 0 !important;
}

/* 3. Lists Optimization (Remove deep indentation) */
ul, ol {
    padding-right: 15px !important; /* Minimal space for the bullet point only */
    padding-left: 0 !important;
    margin: 0 !important;
}

/* 4. Accordion/Cards Internals */
.accordion-panel {
    padding: 8px 2px !important; /* Vertical spacing ok, Horizontal tight */
}

.qa {
    margin: 5px 0 !important;
    padding: 5px !important;
    border-radius: 4px !important;
}

/* 5. Headings */
h1, h2, h3, h4, h5, h6 {
    text-align: right !important; /* Headings stay right-aligned */
    padding: 4px 0 !important;
}

/* === MOBILE QUIZ OPTIMIZATION === */

/* 1. Maximize Quiz Container (Reduce Margins) */
#quiz-container, 
.container-main,
.question-card {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    padding: 10px 5px !important; /* Very minimal padding */
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
}

/* 2. Large Question Text */
#question-text, 
.question-text {
    font-size: 1.4rem !important; /* Significantly larger (approx 22px) */
    line-height: 1.3 !important;
    font-weight: 800 !important;
    margin-bottom: 20px !important;
    padding: 0 5px !important;
    text-align: center !important;
}

/* 3. Big Answer Buttons */
.btn-answer, 
.answer-option {
    font-size: 1.25rem !important; /* Large readable text (20px) */
    padding: 15px 10px !important; /* Taller click area */
    min-height: 65px !important;   /* Easy to tap */
    margin-bottom: 12px !important;
    border-radius: 12px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    text-align: center !important;
    line-height: 1.2 !important;
    width: 100% !important; /* Ensure they fill the column */
}

/* 4. Tighter Grid (If using CSS Grid) */
.answers-grid {
    gap: 12px !important;
    padding: 0 !important;
    margin: 0 !important;
}

/* 5. Fix "Question Number" Badge */
.question-number-badge, 
.badge {
    font-size: 1rem !important;
    padding: 6px 12px !important;
}

/* === 1. FIX PROGRESS BAR (Force Single Row) === */
/* These rules are now consolidated later in the media query for better organization */

/* === 2. FIX COMPARISON QUIZ LAYOUT (Compact Side-by-Side) === */

/* === ULTRA-COMPACT COMPARISON CARDS === */

/* Remove main container margins */
.comparison-container, 
#quiz-container {
    width: 100% !important;
    padding: 0 2px !important; /* Almost edge to edge */
    margin: 0 !important;
}

/* 4. Ensure container is edge-to-edge */
.comparison-options-wrapper,
.options-grid {
    display: flex !important;
    gap: 2px !important; /* Minimal gap between the two cards */
    padding: 0 !important;
    justify-content: space-between !important;
    width: 100% !important;
}

/* 1. The Card Container */
.comparison-card, 
.option-card,
.answer-card {
    flex: 1 !important; /* Split width 50/50 */
    width: 48% !important; /* Ensure they fit */
    padding: 4px 2px !important; /* Almost zero padding */
    margin: 0 !important;
    border-radius: 4px !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: center !important;
    min-height: auto !important; /* Let content dictate height */

    /* PREVENT OVERFLOW */
    overflow-wrap: break-word !important;
    word-wrap: break-word !important;
    hyphens: auto !important;
    white-space: normal !important;
}

/* 2. Text Content Inside Cards */
.comparison-card h3, 
.comparison-card p,
.option-card h3,
.option-card p,
.card-content {
    margin: 2px 0 !important; /* Remove paragraph spacing */
    padding: 0 !important;
    line-height: 1.2 !important; /* Tighter lines */
    text-align: center !important;
    width: 100% !important;
}

/* 3. Reduce Font Size Slightly if needed to fit side-by-side */
.comparison-card h3,
.option-card h3 {
    font-size: 0.95rem !important; /* slightly smaller header */
    margin-bottom: 6px !important;
}
.comparison-card p,
.option-card p {
    font-size: 0.9rem !important;
}

/* === 1. REMOVE GHOST SPACE AT TOP === */
/* The HTML has 'pt-10' (40px padding) for the desktop nav. We must remove it on mobile. */
.main-width-container {
    padding-top: 10px !important; /* Minimal spacing from top edge */
}

/* === 2. FIX FLIP CARD DIMENSIONS === */
/* Restore the "Card" look for Flip Cards (prevent edge-to-edge stretching) */
.flip-card-container, 
.card-flip-wrapper,
.perspective-container {
    width: 90% !important; /* Don't touch edges */
    max-width: 340px !important; /* Limit width */
    margin: 20px auto !important; /* Center it with spacing */
    height: 400px !important; /* Ensure generic height if collapsed */
}

/* Ensure the scene/inner card respects the container */
.flip-card-inner, 
.card-scene {
    width: 100% !important;
    height: 100% !important;
}

/* Ensure comparison quiz header doesn't get squashed */
.page-title-card h1 {
    font-size: 1.5rem !important;
    margin-bottom: 5px !important;
}

/* === 1. FORCE COMPACT STATUS BAR (SINGLE ROW) === */
/* These rules are now consolidated at the end of the media query */

/* === 2. FIX COMPARISON CARDS (STRICT GRID) === */
/* Remove ALL outer spacing */
.comparison-container, #quiz-container {
    padding: 0 !important;
    margin: 0 !important;
    width: 100vw !important; /* Force full viewport width */
    max-width: 100vw !important;
}

/* Grid Layout: Exactly 2 Columns */
.comparison-options-wrapper {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important; /* Equal split */
    gap: 2px !important; /* Tiny gap */
    width: 100% !important;
    padding: 0 2px !important;
}

/* The Cards Themselves */
.comparison-card, .option-card {
    width: 100% !important;
    margin: 0 !important;
    padding: 6px 3px !important;
    min-height: 100px !important; /* Minimum height */
    height: auto !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: flex-start !important;
    border-radius: 4px !important;
}

/* Shrink Text to Fit Mobile */
.comparison-card h3, .option-card h3 {
    font-size: 13px !important; /* Smaller header */
    margin-bottom: 4px !important;
    line-height: 1.2 !important;
    white-space: normal !important;
}

.comparison-card p, .option-card p, .comparison-card .text-sm {
    font-size: 12px !important; /* Smaller body text */
    line-height: 1.3 !important;
    margin: 0 !important;
    padding: 0 !important;
    white-space: normal !important;
}

/* Fix "Question Text" Size for Comparison Page */
.question-text {
    font-size: 18px !important; /* slightly smaller than MCQ to fit more context */
    padding: 5px !important;
    margin-bottom: 10px !important;
}

/* === UNIFIED STATUS BAR FOR ALL QUIZ TYPES === */
/* DIAGNOSTIC FIX: Force status bar visibility and correct layout */

#status-bar-placeholder {
    display: block !important;
    width: 100% !important;
    margin: 4px 0 !important;
    padding: 0 !important;
    background: transparent !important;
    position: relative !important;
    z-index: 40 !important;
}

/* Main container - ensure it displays as row on mobile */
#status-bar-placeholder .container-main {
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
    justify-content: space-between !important;
    width: 100% !important;
    height: auto !important;
    min-height: auto !important;
    padding: 2px 4px !important;
    margin: 0 !important;
    background: white !important;
    border-radius: 4px !important;
    gap: 4px !important;
}

/* Progress section - flex-grow */
#status-bar-placeholder .flex-grow {
    flex: 1 1 auto !important;
    min-width: 0 !important;
    padding: 4px 6px !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: center !important;
    gap: 2px !important;
}

/* Score section - flex-none */
#status-bar-placeholder .flex-none {
    flex: 0 0 auto !important;
    min-width: 110px !important;
    padding: 2px 4px !important;
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    justify-content: space-between !important;
    gap: 2px !important;
    background: transparent !important;
}

/* Labels and text visibility */
#status-bar-placeholder span {
    display: inline-block !important;
    white-space: nowrap !important;
    margin: 0 !important;
    padding: 0 !important;
}

#status-bar-placeholder .opacity-80 {
    display: inline !important;
    font-size: 9px !important;
    opacity: 1 !important;
    line-height: 1 !important;
}

#status-bar-placeholder .text-xs {
    display: inline !important;
    font-size: 9px !important;
    line-height: 1 !important;
}

/* Progress bar container */
#status-bar-placeholder .progress-bar {
    display: block !important;
    height: 6px !important;
    width: 100% !important;
    background-color: #ddd !important;
    border-radius: 3px !important;
    overflow: hidden !important;
    margin: 1px 0 !important;
}

/* Progress fill */
#status-bar-placeholder .progress-fill,
#status-bar-placeholder #progress-fill {
    display: block !important;
    height: 100% !important;
    width: 0% !important;
    background: #16a34a !important;
    border-radius: 3px !important;
    transition: width 0.3s ease !important;
}

/* Text content */
#progress-text,
#score-display,
#question-counter {
    display: inline !important;
    font-size: 10px !important;
    font-weight: 600 !important;
    margin: 0 !important;
    padding: 0 !important;
    line-height: 1.2 !important;
}

/* Hide dividers */
#status-bar-placeholder .hidden,
#status-bar-placeholder [class*="w-[1px]"],
#status-bar-placeholder [class*="h-[1px]"],
#status-bar-placeholder .w-\[1px\],
#status-bar-placeholder .h-\[1px\] {
    display: none !important;
}

/* Ensure score section divider is hidden */
#status-bar-placeholder .w-\[1px\].h-8,
#status-bar-placeholder [style*="width: 1px"],
#status-bar-placeholder [style*="height: 1px"] {
    display: none !important;
}
}
/* ==========================================================================
   15. SPECIFIC PAGE FIXES (إصلاحات خاصة بالصفحات)
   ========================================================================== */

/* 1. حل مشكلة تلاصق الأزرار في الأسفل */
#navigation-buttons {
    gap: 1.5rem !important; /* يضيف مسافة 24px واضحة بين الزرين */
}

/* في حال كانت كلاسات Tailwind تسبب تداخل في الهوامش مع اتجاه RTL */
#navigation-buttons > * {
    margin-inline-start: 0 !important;
    margin-inline-end: 0 !important;
}

/* 2. تقليل الفراغ (Padding) في حاوية البطاقة للنصف */
/* الـ Padding الأصلي كان p-8 يعني 32px، قمنا بتقليله هنا */
#card-and-buttons-container {
    padding-top: 2.25rem !important;    /* أصبح 16px بدلاً من 32px */
    padding-bottom: 1rem !important; /* للحفاظ على التناسق */
}
